{% extends "user_account/base.html" %}
{% block title %} Report List {% endblock %}
{% load i18n %}

{% block content %}
<style>
	.summary-cards {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
		gap: 1rem;
		margin: 2rem 0;
	}
	
	.summary-card {
		background: white;
		padding: 1.5rem;
		border-radius: 8px;
		box-shadow: 0 2px 4px rgba(0,0,0,0.1);
	}
	
	.card-title {
		color: #666;
		font-size: 0.9rem;
		margin: 0 0 0.5rem 0;
	}
	
	.card-value {
		font-size: 1.5rem;
		font-weight: bold;
		margin: 0;
	}
	
	
	.export-btn {
		float: right;
		margin: 1rem 0;
	}
</style>

<div class="container">
	<a href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}export=csv" 
	   class="export-btn">
		{% trans "Export to CSV" %}
	</a>

	{% if not request.user.is_staff %}
		<a href="{% url 'report:report_create' %}" class="create-report-btn">
			<i class="bi bi-plus-circle"></i> {% trans "Create New Report" %}
		</a>
	{% endif %}

	<div class="summary-cards">
		<div class="summary-card">
			<h3 class="card-title">{% trans "Total Budget" %}</h3>
			<p class="card-value">{{ summary.total_budget|floatformat:"0" }} TZS</p>
		</div>
		
		<div class="summary-card">
			<h3 class="card-title">{% trans "Total Spent" %}</h3>
			<p class="card-value">{{ summary.total_spent|floatformat:"0" }} TZS</p>
		</div>
		
		<div class="summary-card">
			<h3 class="card-title">{% trans "Remaining Budget" %}</h3>
			<p class="card-value">{{ summary.remaining_budget|floatformat:"0" }} TZS</p>
		</div>
		
		<div class="summary-card">
			<h3 class="card-title">{% trans "Budget Utilization" %}</h3>
			<p class="card-value utilization">{{ summary.utilization|floatformat:"1" }}%</p>
		</div>
	</div>

	<form method="get" class="filter-form">
		{{ filter.form.as_p }}
		<button type="submit" class="btn-filter">{% trans "Apply Filters" %}</button>
	</form>

	<table class="report-table">
		<thead>
			<tr>
				{% if is_admin %}<th>{% trans "Organization" %}</th>{% endif %}
				<th>{% trans "Project" %}</th>
				<th>{% trans "Quarter" %}</th>
				<th>{% trans "Year" %}</th>
				<th>{% trans "Amount Used" %}</th>
				<th>{% trans "Submitted" %}</th>
			</tr>
		</thead>
		<tbody>
			{% for report in page_obj %}
			<tr>
				{% if is_admin %}<td>{{ report.project.organization }}</td>{% endif %}
				<td>{{ report.project.name }}</td>
				<td>{{ report.get_quarter_display }}</td>
				<td>{{ report.year }}</td>
				<td>{{ report.amount_used|floatformat:"0" }} TZS</td>
				<td>{{ report.created_at|date:"M d, Y" }}</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
	
	{% include "report/pagination.html" with page=page_obj %}
</div>
{% endblock %}